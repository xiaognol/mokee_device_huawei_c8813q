From 20a5bcd48b11a6a66ce1623325811f73b17ad6c2 Mon Sep 17 00:00:00 2001
From: xiaognol <317065820@qq.com>
Date: Thu, 17 Jul 2014 22:51:55 +0800
Subject: [PATCH] 0001-add-vold-switchablePair-and-thermal

Change-Id: Ife6d287796091c8b20f9b43621b887cc49803138
Signed-off-by: xiaognol <317065820@qq.com>
---
 res/values-zh-rCN/cm_strings.xml                   | 11 +++++++++
 res/values/cm_strings.xml                          | 10 ++++++++
 res/xml/device_info_memory.xml                     |  5 ++++
 res/xml/performance_settings.xml                   |  4 +++-
 .../settings/cyanogenmod/PerformanceSettings.java  | 28 +++++++++++++++++++++-
 5 files changed, 56 insertions(+), 2 deletions(-)

diff --git a/res/values-zh-rCN/cm_strings.xml b/res/values-zh-rCN/cm_strings.xml
index f8521e9..06ff006 100644
--- a/res/values-zh-rCN/cm_strings.xml
+++ b/res/values-zh-rCN/cm_strings.xml
@@ -16,6 +16,17 @@
      limitations under the License.
 -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+    <!-- Performance Settings : Set on thermal option -->
+  <string name="performance_set_thermal">温控调频</string>
+  <string name="thermal_on_summary">温控调节模式开启中，最高频率将不支持手动锁定</string>
+  <string name="thermal_off_summary">温控调节模式已关闭，可以手动锁定最高频率</string>
+  <string name="storage_switch_title">默认存储切换</string>
+  <string name="storage_switch_summary_off">当前默认使用内置卡</string>
+  <string name="storage_switch_summary_on">当前默认使用SD卡</string>
+  <string name="reboot_prompt_title">重启确认</string>
+  <string name="reboot_prompt_message">"为使设置生效，系统需要重启。
+
+想现在就重启吗？"</string>
   <string name="wifi_setting_countrycode_title">WLAN 区域代码</string>
   <string name="wifi_setting_countrycode_summary">指定 WLAN 使用的区域码</string>
   <string name="wifi_setting_countrycode_error">设置区域码时遇到了问题。</string>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index a3ae10c..a5241d2 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -690,6 +690,16 @@ two in order to insert additional control points. \'Remove\' deletes the selecte
     <string name="adb_notify">USB debugging notify</string>
     <string name="adb_notify_summary">Display a notification when USB debugging is connected</string>
 
+    <!-- Vold Switchable Pair -->
+    <string name="storage_switch_title">Use external SD as primary</string>
+    <string name="storage_switch_summary_off">Using expanded internal storage for apps and media</string>
+    <string name="storage_switch_summary_on">Using SD Card for apps and media</string>
+    <string name="reboot_prompt_title">Reboot required</string>
+    <string name="reboot_prompt_message">In order to apply the changed configuration, a reboot is required.\n\nDo you want to reboot now?</string>
+    <!-- Performance Settings : Set on thermal option -->
+    <string name="performance_set_thermal">Set Thermal</string>
+    <string name="thermal_on_summary">Thermal Mode is on,the manual MAX-Frequency is not avaliable</string>
+    <string name="thermal_off_summary">manual MAX-Frequency is OK,now you can change the Max-Frequency manually.</string>
     <!-- Android debugging over WiFi -->
     <string name="adb_over_network">ADB over network</string>
     <string name="adb_over_network_summary">Enable TCP/IP debugging over network interfaces (Wi-Fi, USB networks). This setting is reset on reboot</string>
diff --git a/res/xml/device_info_memory.xml b/res/xml/device_info_memory.xml
index e905f39..2010b2c 100644
--- a/res/xml/device_info_memory.xml
+++ b/res/xml/device_info_memory.xml
@@ -16,6 +16,11 @@
 
 <PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android"
         android:title="@string/storage_settings_title">
+    <CheckBoxPreference
+        android:key="key_switch_storage"
+        android:title="@string/storage_switch_title"
+        android:summaryOn="@string/storage_switch_summary_on"
+        android:summaryOff="@string/storage_switch_summary_off" />
 
 <!-- Preference categories are dynamically created based on the list of available storage volumes -->
 
diff --git a/res/xml/performance_settings.xml b/res/xml/performance_settings.xml
index c6064e1..d358558 100644
--- a/res/xml/performance_settings.xml
+++ b/res/xml/performance_settings.xml
@@ -70,5 +70,7 @@
             android:title="@string/pref_force_highend_gfx_title"
             android:summary="@string/pref_force_highend_gfx_summary" />
     </PreferenceCategory>
-
+    <CheckBoxPreference
+        android:key="set_thermal"
+        android:title="@string/performance_set_thermal" />
 </PreferenceScreen>
diff --git a/src/com/android/settings/cyanogenmod/PerformanceSettings.java b/src/com/android/settings/cyanogenmod/PerformanceSettings.java
index e3380fd..47f8d97 100644
--- a/src/com/android/settings/cyanogenmod/PerformanceSettings.java
+++ b/src/com/android/settings/cyanogenmod/PerformanceSettings.java
@@ -58,6 +58,10 @@ public class PerformanceSettings extends SettingsPreferenceFragment implements
 
     private static final String FORCE_HIGHEND_GFX_PREF = "pref_force_highend_gfx";
     private static final String FORCE_HIGHEND_GFX_PERSIST_PROP = "persist.sys.force_highendgfx";
+/* For Thermald Switch by ZJL@Anzhi */
+    private CheckBoxPreference mThermal;
+    public static final String THERMAL_PROPERTY = "persist.sys.thermal.monitor";
+    private static final String THERMAL_KEY = "set_thermal";
 
     private ListPreference mPerfProfilePref;
     private CheckBoxPreference mUse16bppAlphaPref;
@@ -128,7 +132,13 @@ public class PerformanceSettings extends SettingsPreferenceFragment implements
         } else {
             category.removePreference(findPreference(FORCE_HIGHEND_GFX_PREF));
         }
-
+/* Add Thermald Switch by ZJL@AnZhi */
+	    mThermal = (CheckBoxPreference) prefSet.findPreference(THERMAL_KEY);
+            String thermal = SystemProperties.get(THERMAL_PROPERTY, "0");
+	    mThermal.setChecked("1".equals(thermal));
+	    updateThermalSummary();
+	
+/* Add Thermald Switch by ZJL@AnZhi */
         /* Display the warning dialog */
         alertDialog = new AlertDialog.Builder(getActivity()).create();
         alertDialog.setTitle(R.string.performance_settings_warning_title);
@@ -172,6 +182,10 @@ public class PerformanceSettings extends SettingsPreferenceFragment implements
         } else if (preference == mForceHighEndGfx) {
             SystemProperties.set(FORCE_HIGHEND_GFX_PERSIST_PROP,
                     mForceHighEndGfx.isChecked() ? "true" : "false");
+        } else if (preference == mThermal) {
+            SystemProperties.set(THERMAL_PROPERTY,
+                    mThermal.isChecked() ? "1" : "0");
+	    updateThermalSummary();
         } else {
             // If we didn't handle it, let preferences handle it.
             return super.onPreferenceTreeClick(preferenceScreen, preference);
@@ -232,4 +246,16 @@ public class PerformanceSettings extends SettingsPreferenceFragment implements
         mPerfProfilePref.setValue(mPowerManager.getPowerProfile());
         setCurrentPerfProfileSummary();
     }
+
+    private void updateThermalSummary() {
+	String thermal = SystemProperties.get(THERMAL_PROPERTY, "0");
+	if (SystemProperties.get(THERMAL_PROPERTY).equals("1")) {
+            mThermal.setSummary(R.string.thermal_on_summary);
+        }
+	else
+		{
+			mThermal.setSummary(R.string.thermal_off_summary);
+		}
+		
+	}
 }
-- 
1.8.3.2

